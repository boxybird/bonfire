(()=>{"use strict";function e(e){const t=new URL(e||window.location.href).href;return t.endsWith("/")||t.includes(".")?t:`${t}/`}function t(t){let o;if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return{type:"disqualified"};for(var r=t.target;r.parentNode;r=r.parentNode)if("A"===r.nodeName){o=r;break}if(o&&o.host!==location.host)return o.target="_blank",{type:"external"};if(o&&"cold"in(null==o?void 0:o.dataset))return{type:"disqualified"};if(null!=o&&o.hasAttribute("href")){const r=o.getAttribute("href"),n=new URL(r,location.href);if(t.preventDefault(),null!=r&&r.startsWith("#"))return function(e){document.querySelector(e).scrollIntoView({behavior:"smooth",block:"start"})}(r),{type:"scrolled"};return{type:"link",next:e(n.href),prev:e()}}return{type:"noop"}}function o(e){document.body.replaceWith(e.body)}function r(){document.head.querySelectorAll("[data-reload]").forEach(n),document.body.querySelectorAll("script").forEach(n)}function n(e){const t=document.createElement("script"),o=Array.from(e.attributes);for(const{name:e,value:r}of o)t[e]=r;t.append(e.textContent),e.replaceWith(t)}const i={log:!1,pageTransitions:!1};class s{constructor(e){this.opts=e,this.enabled=!0,this.prefetched=new Set,this.opts={...i,...e},null!=window&&window.history?(document.addEventListener("click",(e=>this.onClick(e))),window.addEventListener("popstate",(e=>this.onPop(e))),this.prefetch()):(console.warn("flamethrower router not supported in this browser or environment"),this.enabled=!1)}go(e){const t=window.location.href,o=new URL(e,location.origin).href;return this.reconstructDOM({type:"go",next:o,prev:t})}back(){window.history.back()}forward(){window.history.forward()}get allLinks(){return Array.from(document.links).filter((e=>e.href.includes(document.location.origin)&&!e.href.includes("#")&&e.href!==(document.location.href||document.location.href+"/")&&!this.prefetched.has(e.href)))}log(...e){this.opts.log&&console.log(...e)}prefetch(){if("visible"===this.opts.prefetch)this.prefetchVisible();else{if("hover"!==this.opts.prefetch)return;this.prefetchOnHover()}}prefetchOnHover(){this.allLinks.forEach((e=>{const t=e.getAttribute("href");e.addEventListener("pointerenter",(()=>this.createLink(t)),{once:!0})}))}prefetchVisible(){"IntersectionObserver"in window&&(this.observer||(this.observer=new IntersectionObserver(((e,t)=>{e.forEach((e=>{const o=e.target.getAttribute("href");this.prefetched.has(o)?t.unobserve(e.target):e.isIntersecting&&(this.createLink(o),t.unobserve(e.target))}))}),{root:null,rootMargin:"0px",threshold:1})),this.allLinks.forEach((e=>this.observer.observe(e))))}createLink(e){const t=document.createElement("link");t.rel="prefetch",t.href=e,t.as="document",t.onload=()=>this.log("ðŸŒ©ï¸ prefetched",e),t.onerror=t=>this.log("ðŸ¤• can't prefetch",e,t),document.head.appendChild(t),this.prefetched.add(e)}onClick(e){this.reconstructDOM(t(e))}onPop(t){this.reconstructDOM({type:"popstate",next:e()})}async reconstructDOM({type:e,next:t,prev:n}){var i;if(this.enabled)try{if(this.log("âš¡",e),["popstate","link","go"].includes(e)&&t!==n){this.opts.log&&console.time("â±ï¸"),window.dispatchEvent(new CustomEvent("router:fetch")),i=t,(!window.history.state||window.history.state.url!==i)&&window.history.pushState({url:i},"internalLink",i);const n=function(e){return(new DOMParser).parseFromString(e,"text/html")}(await(await fetch(t,{headers:{"X-Flamethrower":"1"}})).text());(function(e){const t=e=>Array.from(e.querySelectorAll('head>:not([rel="prefetch"]')),o=t(document),r=t(e),{staleNodes:n,freshNodes:i}=function(e,t){const o=[],r=[];let n=0,i=0;for(;n<e.length&&i<t.length;){const s=e[n],c=t[i];if(s.isEqualNode(c)){n++,i++;continue}const a=r.findIndex((e=>e.isEqualNode(s)));if(-1!==a){r.splice(a,1),n++;continue}const l=o.findIndex((e=>e.isEqualNode(c)));-1===l?(s&&o.push(s),c&&r.push(c),n++,i++):(o.splice(l,1),i++)}return{staleNodes:o,freshNodes:r}}(o,r);n.forEach((e=>e.remove())),document.head.append(...i)})(n),this.opts.pageTransitions&&document.createDocumentTransition?document.createDocumentTransition().start((()=>{o(n),r()})):(o(n),r()),function(e){["link","go"].includes(e)&&window.scrollTo({top:0})}(e),window.dispatchEvent(new CustomEvent("router:end")),setTimeout((()=>{this.prefetch()}),200),this.opts.log&&console.timeEnd("â±ï¸")}}catch(e){return window.dispatchEvent(new CustomEvent("router:error",e)),this.opts.log&&console.timeEnd("â±ï¸"),console.error("ðŸ’¥ router fetch failed",e),!1}else this.log("router disabled")}}var c=(e=>{const t=new s(e);if(e.log&&console.log("ðŸ”¥ flamethrower engaged"),window){window.flamethrower=t}return t})({prefetch:"visible",log:!1,pageTransitions:!1});window.flamethrower_router=c})();